import{_ as e,o as i,c as a,ag as n}from"./chunks/framework.DEqXEGcv.js";const k=JSON.parse('{"title":"Config files","description":"","frontmatter":{},"headers":[],"relativePath":"features/config-files.md","filePath":"features/config-files.md"}'),t={name:"features/config-files.md"};function o(l,s,p,r,h,c){return i(),a("div",null,[...s[0]||(s[0]=[n(`<h1 id="config-files" tabindex="-1">Config files <a class="header-anchor" href="#config-files" aria-label="Permalink to &quot;Config files&quot;">​</a></h1><h2 id="environment-variables" tabindex="-1">Environment variables <a class="header-anchor" href="#environment-variables" aria-label="Permalink to &quot;Environment variables&quot;">​</a></h2><p>Compas lets you forget loading your <code>.env</code> files. All main entry points (<code>mainFn</code> and <code>mainTestFn</code>) will load both the <code>.env</code> and <code>.env.local</code> files automatically. The loader that is used is provided by the <a href="https://www.npmjs.com/package/dotenv" target="_blank" rel="noreferrer">dotenv</a> package.</p><p>Compas advises to check in a ready to go <code>.env.example</code> in your version control or preferably when using all Compas provided tooling, just a <code>.env</code> file without any actual production secrets. This way new contributors can just fire up some commands and verify that they can run your project locally instead of trying to figure out what they need to configure where.</p><p>The <code>.env</code> file loader skips keys already present in your environment. This is also used by the <code>.env.local</code> file. It is loaded first so any environment variables present in both <code>.env.local</code> and <code>.env</code> will have the value defined by the former.</p><p>To speed up accessing environment variables the @compas/stdlib package provides an exported object <code>environment</code> which is an exact copy of <code>process.env</code> before the callback is called in <code>mainFn</code>. If you use <code>process.env</code> to set values, please don&#39;t, you can use <code>refreshEnvironmentCache</code> to make a new copy.</p><div class="danger custom-block"><p class="custom-block-title">DANGER</p><p>Never check in production secrets in to your version control.</p></div><h2 id="config-loader" tabindex="-1">Config loader <a class="header-anchor" href="#config-loader" aria-label="Permalink to &quot;Config loader&quot;">​</a></h2><p>Compas also comes with a configuration file loader in <code>@compas/stdlib</code>. This will be used by other Compas features, but also allows you to have a project specific configuration file. You can use this to validate and convert your environment variables for example doing the following transformation:</p><div class="language-dotenv vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">dotenv</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">POSTGRES_USER</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">postgres</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">POSTGRES_PASSWORD</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">postgres</span></span></code></pre></div><p>to</p><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// config/my-project.js</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> config</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">	return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">		postgres: {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">			user: environment.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">POSTGRES_USER</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">			password: environment.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">POSTGRES_PASSWORD</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">		},</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">	};</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><p>Or it can be used by for example Compas to let you specify your migrations directory to make <code>compas migrate</code> more configurable.</p><p>The configuration files can be in 2 formats: JSON or ES modules (both <code>.js</code> and <code>.mjs</code> extensions are supported). The ES module should export a synchronous function returning a config data object. The configuration files can be loaded from the project root, the project <code>config</code> directory, or from the OS and user specific config directory.</p><p><strong>configLoaderGet()</strong></p><p>The config file load function, it caches results based on the provided name and key. It returns promise resolving to an object with the following properties:</p><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> result</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> await</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> configLoaderGet</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">({ name: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;example&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, location: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;project&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> });</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// always equals to the provided name, &#39;example&#39;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">result.name;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// always equal to the provided location, &#39;project&#39;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">result.location;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// object, does not exist if no config file is found</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">result.resolvedLocation;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// The directory where the config file is found</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">result.resolvedLocation.directory;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Filename with extension, \`example.json\` or \`example.js\` or \`example.mjs\`</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">result.resolvedLocation.filename;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Object, either the object returned from a config function or a parsed json file.</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// This is an empty object if no config file is found</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">result.data;</span></span></code></pre></div><p><strong>configLoaderDeleteCache</strong></p><p>Delete the config loader cache. This can be used if your tool overwrites the config, or when writing some reload / watch behaviour.</p>`,19)])])}const g=e(t,[["render",o]]);export{k as __pageData,g as default};
